<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬è©¦å¤šå€‹ DownloadBlock</title>
    <style>
        body {
            background: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .test-section {
            margin: 40px 0;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 8px;
        }
        h2 {
            color: #ff6b35;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            background: #333;
        }
        .success { background: #2d5a27; }
        .error { background: #5a2727; }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #ff6b35;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #e55a2b;
        }
    </style>
</head>
<body>
    <h1>DownloadBlock é€šçŸ¥ç³»çµ±æ¸¬è©¦</h1>
    
    <div class="test-section">
        <h2>æ¸¬è©¦æ­¥é©Ÿ</h2>
        <ol>
            <li>æª¢æŸ¥å…¨å±€é€šçŸ¥ç³»çµ±æ˜¯å¦æ­£ç¢ºåˆå§‹åŒ–ï¼ˆæ‡‰è©²åªæœ‰ä¸€å€‹å¯¦ä¾‹ï¼‰</li>
            <li>æ¨¡æ“¬æœªç™»å…¥ç”¨æˆ¶é»æ“Šå…è²»æª”æ¡ˆä¸‹è¼‰</li>
            <li>é©—è­‰é€šçŸ¥æ˜¯å¦åªé¡¯ç¤ºä¸€æ¬¡</li>
            <li>æ¸¬è©¦é€šçŸ¥çš„æ‰‹å‹•é—œé–‰åŠŸèƒ½</li>
            <li>æ¸¬è©¦é€šçŸ¥çš„è‡ªå‹•æ¶ˆå¤±åŠŸèƒ½</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ç³»çµ±ç‹€æ…‹æª¢æŸ¥</h2>
        <div id="systemStatus" class="status">æª¢æŸ¥ä¸­...</div>
        <button onclick="checkSystem()">é‡æ–°æª¢æŸ¥ç³»çµ±</button>
        <button onclick="clearStorage()">æ¸…é™¤ç™»å…¥ç‹€æ…‹</button>
    </div>

    <div class="test-section">
        <h2>é€šçŸ¥æ¸¬è©¦</h2>
        <button onclick="testWarningNotification()">æ¸¬è©¦è­¦å‘Šé€šçŸ¥</button>
        <button onclick="testErrorNotification()">æ¸¬è©¦éŒ¯èª¤é€šçŸ¥</button>
        <button onclick="testSuccessNotification()">æ¸¬è©¦æˆåŠŸé€šçŸ¥</button>
        <button onclick="testMultipleNotifications()">æ¸¬è©¦å¤šå€‹é€šçŸ¥</button>
    </div>

    <div class="test-section">
        <h2>æ¨¡æ“¬ä¸‹è¼‰æ¸¬è©¦</h2>
        <button onclick="simulateFreeDownload()">æ¨¡æ“¬å…è²»æª”æ¡ˆä¸‹è¼‰ï¼ˆæœªç™»å…¥ï¼‰</button>
        <button onclick="simulateLoginAndDownload()">æ¨¡æ“¬ç™»å…¥å¾Œä¸‹è¼‰</button>
    </div>

    <script>
        // æ¨¡æ“¬é€šçŸ¥ç³»çµ±ï¼ˆç°¡åŒ–ç‰ˆï¼‰
        class TestNotificationSystem {
            constructor() {
                this.container = null;
                this.notifications = new Map();
                this.nextId = 1;
                this.init();
            }

            init() {
                this.container = document.getElementById('notification-container');
                if (!this.container) {
                    this.container = document.createElement('div');
                    this.container.id = 'notification-container';
                    this.container.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        z-index: 10000;
                        pointer-events: none;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                    `;
                    document.body.appendChild(this.container);
                }
                console.log('âœ… Test notification system initialized');
            }

            show(message, type = 'info', options = {}) {
                const { title = null, duration = 5000 } = options;
                const notificationId = `notification-${this.nextId++}-${Date.now()}`;
                
                console.log(`ğŸ”” Creating ${type} notification:`, { id: notificationId, message });

                const notification = this.createNotification(message, type, title, notificationId);
                this.container.appendChild(notification);
                this.notifications.set(notificationId, notification);

                setTimeout(() => notification.classList.add('show'), 10);

                if (duration > 0) {
                    setTimeout(() => this.remove(notificationId), duration);
                }

                return notificationId;
            }

            createNotification(message, type, title, id) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.style.cssText = `
                    background: #ffffff;
                    border: 1px solid #e5e7eb;
                    border-radius: 8px;
                    padding: 20px 30px;
                    margin-bottom: 12px;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    min-width: 300px;
                    max-width: 500px;
                    pointer-events: auto;
                    transform: translateY(-100px);
                    opacity: 0;
                    transition: all 0.3s ease-out;
                    color: #333;
                `;

                if (type === 'warning') {
                    notification.style.borderLeft = '4px solid #f59e0b';
                } else if (type === 'error') {
                    notification.style.borderLeft = '4px solid #ef4444';
                } else if (type === 'success') {
                    notification.style.borderLeft = '4px solid #10b981';
                }

                const content = document.createElement('div');
                if (title) {
                    const titleEl = document.createElement('div');
                    titleEl.textContent = title;
                    titleEl.style.fontWeight = 'bold';
                    content.appendChild(titleEl);
                }

                const messageEl = document.createElement('div');
                messageEl.textContent = message;
                content.appendChild(messageEl);

                const closeBtn = document.createElement('button');
                closeBtn.textContent = 'Ã—';
                closeBtn.style.cssText = `
                    position: absolute;
                    top: 8px;
                    right: 8px;
                    border: none;
                    background: none;
                    cursor: pointer;
                    font-size: 18px;
                `;
                closeBtn.addEventListener('click', () => this.remove(id));

                notification.appendChild(content);
                notification.appendChild(closeBtn);

                return notification;
            }

            remove(id) {
                const notification = this.notifications.get(id);
                if (!notification) return;

                notification.style.transform = 'translateY(-50px)';
                notification.style.opacity = '0';

                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                    this.notifications.delete(id);
                }, 300);
            }

            warning(message, options = {}) {
                return this.show(message, 'warning', options);
            }

            error(message, options = {}) {
                return this.show(message, 'error', options);
            }

            success(message, options = {}) {
                return this.show(message, 'success', options);
            }
        }

        // åˆå§‹åŒ–æ¸¬è©¦é€šçŸ¥ç³»çµ±
        if (!window.notify) {
            window.notify = new TestNotificationSystem();
            window.notificationSystemReady = true;
        }

        // æ·»åŠ  show æ¨£å¼
        const style = document.createElement('style');
        style.textContent = `
            .notification.show {
                transform: translateY(0) !important;
                opacity: 1 !important;
            }
        `;
        document.head.appendChild(style);

        function checkSystem() {
            const status = document.getElementById('systemStatus');
            const hasNotify = !!window.notify;
            const hasContainer = !!document.getElementById('notification-container');
            const isLoggedIn = !!localStorage.getItem('auth_token');
            
            let statusText = `
                é€šçŸ¥ç³»çµ±: ${hasNotify ? 'âœ… å·²åˆå§‹åŒ–' : 'âŒ æœªåˆå§‹åŒ–'}<br>
                é€šçŸ¥å®¹å™¨: ${hasContainer ? 'âœ… å·²å‰µå»º' : 'âŒ æœªå‰µå»º'}<br>
                ç™»å…¥ç‹€æ…‹: ${isLoggedIn ? 'âœ… å·²ç™»å…¥' : 'âŒ æœªç™»å…¥'}<br>
                æº–å‚™ç‹€æ…‹: ${window.notificationSystemReady ? 'âœ… æº–å‚™å°±ç·’' : 'âŒ æœªæº–å‚™'}
            `;
            
            status.innerHTML = statusText;
            status.className = 'status ' + (hasNotify && hasContainer ? 'success' : 'error');
        }

        function clearStorage() {
            localStorage.removeItem('auth_token');
            checkSystem();
            console.log('ğŸ—‘ï¸ å·²æ¸…é™¤ç™»å…¥ç‹€æ…‹');
        }

        function testWarningNotification() {
            if (window.notify) {
                window.notify.warning('é€™æ˜¯ä¸€å€‹è­¦å‘Šé€šçŸ¥æ¸¬è©¦', {
                    title: 'è­¦å‘Š',
                    duration: 4000
                });
            }
        }

        function testErrorNotification() {
            if (window.notify) {
                window.notify.error('é€™æ˜¯ä¸€å€‹éŒ¯èª¤é€šçŸ¥æ¸¬è©¦', {
                    title: 'éŒ¯èª¤',
                    duration: 5000
                });
            }
        }

        function testSuccessNotification() {
            if (window.notify) {
                window.notify.success('é€™æ˜¯ä¸€å€‹æˆåŠŸé€šçŸ¥æ¸¬è©¦', {
                    title: 'æˆåŠŸ',
                    duration: 3000
                });
            }
        }

        function testMultipleNotifications() {
            if (window.notify) {
                window.notify.warning('ç¬¬ä¸€å€‹é€šçŸ¥', { title: 'é€šçŸ¥ 1' });
                setTimeout(() => {
                    window.notify.error('ç¬¬äºŒå€‹é€šçŸ¥', { title: 'é€šçŸ¥ 2' });
                }, 500);
                setTimeout(() => {
                    window.notify.success('ç¬¬ä¸‰å€‹é€šçŸ¥', { title: 'é€šçŸ¥ 3' });
                }, 1000);
            }
        }

        function simulateFreeDownload() {
            // æ¸…é™¤ç™»å…¥ç‹€æ…‹
            localStorage.removeItem('auth_token');
            
            if (window.notify) {
                window.notify.warning('è«‹å…ˆç™»å…¥æœƒå“¡å¾Œå†ä¸‹è¼‰æª”æ¡ˆ', {
                    title: 'éœ€è¦ç™»å…¥',
                    duration: 4000
                });
            }
        }

        function simulateLoginAndDownload() {
            // æ¨¡æ“¬ç™»å…¥
            localStorage.setItem('auth_token', 'fake-token-for-test');
            
            if (window.notify) {
                window.notify.success('å·²ç™»å…¥ï¼Œé–‹å§‹ä¸‹è¼‰...', {
                    title: 'ä¸‹è¼‰é–‹å§‹',
                    duration: 2000
                });
            }
        }

        // é é¢åŠ è¼‰æ™‚æª¢æŸ¥ç³»çµ±
        document.addEventListener('DOMContentLoaded', checkSystem);
    </script>
</body>
</html>
