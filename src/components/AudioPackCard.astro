---
import type { PostCardProps } from "@src-types/types";
import { Image } from "astro:assets";
import { formatDate } from "@js/global.js"
import { slugify } from "@utils/utils";

import "@styles/card.css";

const { post } = Astro.props as PostCardProps;
const formatted_date = formatDate(post.data.pub_date);

let tag_slug, tag_name;

if(post.data.tags && post.data.tags.length > 0){
    tag_name = post.data.tags[0];
    tag_slug = slugify(tag_name)
}

// 创建所有标签的 slug 数组用于过滤
const tagSlugs = post.data.tags ? post.data.tags.map(tag => slugify(tag)).join(',') : '';
---

<div class="card audiopack-card" data-tags={tagSlugs}>
    <div class="card-info-top">
        <small class="flex-center">            {tag_slug &&
                <>
                    <a href={`/audiopacks/`} data-tag-filter={tag_slug}>{tag_name}</a>  
                    &nbsp;|
                </>
            }
            {formatted_date}     
        </small>
        <div class="card-title-wrapper">
            <div class="medium-text">
                <a href={`/audiopacks/${post.id}`}>
                    {post.data.title}
                </a>
            </div>
        </div>
    </div>

    <a href={`/audiopacks/${post.id}/`} class="card-image" aria-label={post.data.title}>
        {post.data.feature_image ? (                 
            <figure>
                <Image 
                    class="scale-in"
                    src={post.data.feature_image as any} 
                    alt={post.data.title}
                    loading="lazy" 
                    format="webp"
                    widths={[300, 400, 600, 800, 1000, 1200, 1600]}
                />
            </figure>
        ) : (
            <figure>
                <div class="placeholder-img"></div>
            </figure>
        )}
    </a>
</div>
