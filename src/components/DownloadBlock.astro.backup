---
interface Props {
  downloadUrl: string;
  title?: string;
  description?: string;
  fileSize?: string;
  requiresMembership?: boolean;
  require_tier?: 0 | 1 | 2 | 3;
}

const {
  downloadUrl,
  title = "ä¸‹è¼‰æª”æ¡ˆ",
  description,
  fileSize,
  requiresMembership = false,
  require_tier = 0
} = Astro.props;

const tierNameMap = [
  'å…è²»',
  'Support',
  "Creator's Choice",
  'My Hero'
];
const getTierLabel = (tier: number) => tierNameMap[tier] || 'æœªçŸ¥ç­‰ç´š';
const getTierString = (tier: number) => tierNameMap[tier] || 'Support';

const getFileInfo = (url: string) => {
  const fileName = url.split('/').pop() || 'unknown';
  const fileExtension = fileName.split('.').pop()?.toLowerCase() || '';
  const formatInfo = {
    'wav': { format: 'WAV', color: '#ff6b35' },
    'mp3': { format: 'MP3', color: '#4CAF50' },
    'flac': { format: 'FLAC', color: '#2196F3' },
    'aiff': { format: 'AIFF', color: '#9C27B0' },
    'ogg': { format: 'OGG', color: '#FF9800' },
    'm4a': { format: 'M4A', color: '#795548' },
    'aac': { format: 'AAC', color: '#607D8B' },
    'zip': { format: 'ZIP', color: '#607D8B' },
    'rar': { format: 'RAR', color: '#795548' },
    '7z': { format: '7Z', color: '#9C27B0' }
  };
  const info = formatInfo[fileExtension as keyof typeof formatInfo] || {
    format: fileExtension.toUpperCase(),
    color: '#666'
  };
  return {
    fileName,
    fileFormat: info.format,
    formatColor: info.color,
    fileSize: fileSize || 'æª”æ¡ˆå¤§å°æœªçŸ¥'
  };
};
const fileInfo = getFileInfo(downloadUrl);
---

<div class="download-block-flex" data-download-url={downloadUrl} data-requires-membership={requiresMembership} data-require-tier={require_tier}>
  <div class="membership-label">{getTierLabel(require_tier)}</div>  <div class="download-flex-row">
    <div class="file-info-flex">
      <div class="file-title">{title}</div>
      {description && <div class="file-description">{description}</div>}
      <div class="file-badges">
        <span class="badge format-badge" style={`background:${fileInfo.formatColor}`}>{fileInfo.fileFormat}</span>
        <span class="badge size-badge" data-file-size>{fileInfo.fileSize}</span>
        <span class="badge name-badge">{fileInfo.fileName}</span>
      </div>
    </div>
    <div class="file-action-flex">
      <button class="download-btn-flex" data-download-action disabled>ä¸‹è¼‰</button>
    </div>
  </div>
</div>

<script type="module">
  // å®Œå…¨é‡å¯«çš„é€šçŸ¥ç³»çµ±
  class NotificationSystem {
    constructor() {
      this.container = null;
      this.notifications = new Map();
      this.nextId = 1;
      this.init();
    }

    init() {
      this.container = document.getElementById('notification-container');
      if (!this.container) {
        this.container = document.createElement('div');
        this.container.id = 'notification-container';
        this.container.className = 'notification-container';
        this.container.style.cssText = `
          position: fixed;
          top: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 10000;
          pointer-events: none;
          display: flex;
          flex-direction: column;
          align-items: center;
        `;
        document.body.appendChild(this.container);
      }
      console.log('âœ… Notification system initialized');
    }

    show(message, type = 'info', options = {}) {
      const {
        title = null,
        duration = 5000,
        persistent = false
      } = options;

      // ä½¿ç”¨éå¢ ID é¿å…é‡è¤‡
      const notificationId = `notification-${this.nextId++}-${Date.now()}`;
      console.log('ğŸ”” Creating notification:', { id: notificationId, type, message });

      const notification = this.createNotification(message, type, title, notificationId);
      this.container.appendChild(notification);
      this.notifications.set(notificationId, notification);

      // å»¶é²æ·»åŠ  show é¡ä¾†è§¸ç™¼å‹•ç•«
      setTimeout(() => {
        notification.classList.add('show');
      }, 10);

      // è‡ªå‹•ç§»é™¤
      if (!persistent && duration > 0) {
        console.log(`â° Setting auto-remove timer for ${duration}ms`);
        setTimeout(() => {
          console.log('â° Auto-remove timer triggered');
          this.remove(notificationId);
        }, duration);
      }

      return notificationId;
    }

    createNotification(message, type, title, id) {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.dataset.id = id;
      notification.style.cssText = `
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px 30px;
        margin-bottom: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        min-width: 300px;
        max-width: 500px;
        pointer-events: auto;
        transform: translateY(-100px) scale(0.95);
        opacity: 0;
        transition: all 0.3s ease-out;
        position: relative;
      `;

      // æ ¹æ“šé¡å‹è¨­ç½®é‚Šæ¡†å’ŒèƒŒæ™¯
      if (type === 'warning') {
        notification.style.borderLeft = '4px solid #f59e0b';
        notification.style.background = 'linear-gradient(135deg, #fffbeb 0%, #fefce8 100%)';
      } else if (type === 'error') {
        notification.style.borderLeft = '4px solid #ef4444';
        notification.style.background = 'linear-gradient(135deg, #fef2f2 0%, #fef7f7 100%)';
      } else if (type === 'success') {
        notification.style.borderLeft = '4px solid #10b981';
        notification.style.background = 'linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%)';
      }

      const content = document.createElement('div');
      content.style.cssText = `
        display: flex;
        align-items: flex-start;
        gap: 12px;
      `;

      const icon = document.createElement('div');
      icon.style.cssText = `
        width: 20px;
        height: 20px;
        flex-shrink: 0;
        margin-top: 2px;
        font-weight: bold;
        font-size: 24px;
      `;
      
      if (type === 'warning') {
        icon.textContent = 'âš ';
        icon.style.color = '#f59e0b';
      } else if (type === 'error') {
        icon.textContent = 'âœ•';
        icon.style.color = '#ef4444';
      } else if (type === 'success') {
        icon.textContent = 'âœ“';
        icon.style.color = '#10b981';
      }

      const textContainer = document.createElement('div');
      textContainer.style.cssText = 'flex: 1;';

      if (title) {
        const titleElement = document.createElement('div');
        titleElement.textContent = title;
        titleElement.style.cssText = `
          font-weight: 600;
          color: #1f2937;
          margin: 0 0 4px 0;
        `;
        textContainer.appendChild(titleElement);
      }

      const messageElement = document.createElement('div');
      messageElement.textContent = message;
      messageElement.style.cssText = `
        color: #4b5563;
        margin: 0;
        line-height: 1.4;
      `;
      textContainer.appendChild(messageElement);

      const closeButton = document.createElement('button');
      closeButton.textContent = 'Ã—';
      closeButton.style.cssText = `
        position: absolute;
        top: 8px;
        right: 8px;
        width: 24px;
        height: 24px;
        border: none;
        background: none;
        cursor: pointer;
        color: #6b7280;
        font-size: 18px;
        line-height: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        transition: background-color 0.2s ease;
      `;

      // ä½¿ç”¨ bind ç¢ºä¿æ­£ç¢ºçš„ this ç¶å®š
      closeButton.addEventListener('click', this.remove.bind(this, id));
      closeButton.addEventListener('mouseenter', () => {
        closeButton.style.backgroundColor = '#f3f4f6';
      });
      closeButton.addEventListener('mouseleave', () => {
        closeButton.style.backgroundColor = 'transparent';
      });

      content.appendChild(icon);
      content.appendChild(textContainer);
      notification.appendChild(content);
      notification.appendChild(closeButton);

      return notification;
    }

    remove(id) {
      console.log('ğŸ—‘ï¸ Attempting to remove notification:', id);
      const notification = this.notifications.get(id);
      
      if (!notification) {
        console.log('âŒ Notification not found in map');
        return;
      }

      if (!notification.parentNode) {
        console.log('âŒ Notification has no parent');
        this.notifications.delete(id);
        return;
      }

      console.log('âœ… Removing notification...');
      
      // æ·»åŠ éš±è—æ¨£å¼
      notification.style.transform = 'translateY(-50px) scale(0.9)';
      notification.style.opacity = '0';
      notification.style.pointerEvents = 'none';

      setTimeout(() => {
        if (notification.parentNode) {
          console.log('ğŸ—‘ï¸ Removing from DOM');
          notification.parentNode.removeChild(notification);
        }
        this.notifications.delete(id);
        console.log('âœ… Notification removed successfully');
      }, 300);
    }

    // show é¡åˆ¥çš„å‹•ç•«
    addShowClass(notification) {
      notification.style.transform = 'translateY(0) scale(1)';
      notification.style.opacity = '1';
    }

    success(message, options = {}) {
      return this.show(message, 'success', options);
    }

    error(message, options = {}) {
      return this.show(message, 'error', options);
    }

    warning(message, options = {}) {
      return this.show(message, 'warning', options);
    }

    info(message, options = {}) {
      return this.show(message, 'info', options);
    }
  }  // ç¢ºä¿é€šçŸ¥ç³»çµ±åœ¨å…¨å±€å¯ç”¨ï¼ˆåªåˆå§‹åŒ–ä¸€æ¬¡ï¼‰
  if (!window.notificationSystemInitialized) {
    console.log('ğŸš€ Initializing global notification system...');
    window.notify = new NotificationSystem();
    window.notificationSystemInitialized = true;
    
    // ç‚º show é¡åˆ¥æ·»åŠ æ¨£å¼ï¼ˆåªæ·»åŠ ä¸€æ¬¡ï¼‰
    if (!document.getElementById('notification-styles')) {
      const style = document.createElement('style');
      style.id = 'notification-styles';
      style.textContent = `
        .notification.show {
          transform: translateY(0) scale(1) !important;
          opacity: 1 !important;
        }
      `;
      document.head.appendChild(style);
    }
  } else {
    console.log('âœ… Global notification system already exists');
  }
  
  async function fetchFileSize(url) {
    try {
      const response = await fetch(url, { method: 'HEAD' });
      const contentLength = response.headers.get('Content-Length');
      if (contentLength) {
        const bytes = parseInt(contentLength);
        return formatFileSize(bytes);
      }
    } catch {}
    return '';
  }
  function formatFileSize(bytes) {
    if (!bytes) return 'æª”æ¡ˆå¤§å°æœªçŸ¥';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }  function getAuthToken() {
    return localStorage.getItem('auth_token');
  }
    // æª¢æŸ¥ç”¨æˆ¶æœƒå“¡ç­‰ç´š
  async function checkUserTier() {
    const token = getAuthToken();
    if (!token) return null;
    
    try {
      const response = await fetch('http://localhost:3001/api/user/profile', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      if (response.ok) {
        const data = await response.json();
        return data.user.tier;
      }
    } catch (error) {
      console.error('Failed to get user info:', error);
    }
    return null;
  }
    // æ¯”è¼ƒæœƒå“¡ç­‰ç´š
  function compareTiers(userTier, requiredTier) {
    const tierLevels = {
      'Free': 0,
      'Support': 1,
      'Creator\'s Choice': 2,
      'My Hero': 3
    };
    return tierLevels[userTier] >= tierLevels[requiredTier];
  }
  
  // å‘å¾Œç«¯é©—è­‰ä¸‹è¼‰æ¬Šé™ï¼ˆæœ€çµ‚å®‰å…¨æª¢æŸ¥ï¼‰
  async function verifyDownloadPermission(fileUrl) {
    const token = getAuthToken();
    if (!token) {
      return { allowed: false, message: 'è«‹å…ˆç™»å…¥' };
    }
    
    try {
      // å¾æª”æ¡ˆ URL ä¸­æå–æª”æ¡ˆåä½œç‚º fileId
      const fileName = fileUrl.split('/').pop();
      console.log('å‘å¾Œç«¯é©—è­‰æª”æ¡ˆæ¬Šé™:', fileName);
      const response = await fetch(`http://localhost:3001/api/check-download-access/${fileName}`, {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      
      console.log('å¾Œç«¯å›æ‡‰ç‹€æ…‹:', response.status);
      if (response.ok) {
        return { allowed: true };      } else {
        const data = await response.json();
        console.log('å¾Œç«¯é©—è­‰å¤±æ•—ï¼Œå›å‚³è³‡æ–™:', data);
        
        // æ ¹æ“šä¸åŒéŒ¯èª¤é¡å‹çµ¦å‡ºä¸åŒæç¤º
        let message = 'å¾Œç«¯é©—è­‰å¤±æ•—';
        if (data.error === 'File not found') {
          message = 'æª”æ¡ˆä¸å­˜åœ¨æ–¼ç³»çµ±ä¸­ï¼Œè«‹è¯ç¹«ç®¡ç†å“¡';
        } else if (data.required_tier && data.current_tier) {
          message = `éœ€è¦ ${data.required_tier} ç­‰ç´šï¼Œæ‚¨ç›®å‰æ˜¯ ${data.current_tier}`;
        } else {
          message = data.error || 'æ¬Šé™é©—è­‰å¤±æ•—';
        }
        
        return { 
          allowed: false, 
          message: message
        };
      }
    } catch (error) {
      console.error('Download permission check failed:', error);
      return { allowed: false, message: 'æ¬Šé™é©—è­‰å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦' };
    }
  }  // åˆå§‹åŒ–ç•¶å‰çµ„ä»¶çš„ä¸‹è¼‰å€å¡Šï¼ˆä¸ä½¿ç”¨ DOMContentLoadedï¼‰
  async function initDownloadBlock() {
    // åªè™•ç†ç•¶å‰è…³æœ¬æ‰€å±¬çš„ä¸‹è¼‰å€å¡Š
    const currentScript = document.currentScript;
    if (!currentScript) return;
    
    const block = currentScript.closest('.download-block-flex');
    if (!block) return;

    console.log('ğŸ”§ Initializing download block:', block);
    
    const btn = block.querySelector('.download-btn-flex');
    const requiresMembership = block.getAttribute('data-requires-membership') === 'true';
    const requireTier = parseInt(block.getAttribute('data-require-tier'));
    const downloadUrl = block.getAttribute('data-download-url');
    const fileSizeElement = block.querySelector('[data-file-size]');
    
    // æª”æ¡ˆå¤§å°è‡ªå‹•è£œå…¨
    if (fileSizeElement && fileSizeElement.textContent === 'æª”æ¡ˆå¤§å°æœªçŸ¥') {
      const realSize = await fetchFileSize(downloadUrl);
      if (realSize) fileSizeElement.textContent = realSize;
    }

    // æ ¹æ“šæœƒå“¡ç­‰ç´šè¨­å®šèƒŒæ™¯è‰²å½©
    const tierClasses = ['tier-free', 'tier-support', 'tier-creators', 'tier-hero'];
    block.classList.add(tierClasses[requireTier] || 'tier-free');

    // æ‰€æœ‰æª”æ¡ˆéƒ½éœ€è¦æª¢æŸ¥ç™»å…¥ç‹€æ…‹
    const userTier = await checkUserTier();
    let frontendCheckPassed = false;

    // å…è²»æª”æ¡ˆï¼ˆrequire_tier ç‚º 0ï¼‰- æŒ‰éˆ•å§‹çµ‚å¯é»æ“Š
    if (requireTier === 0) {
      frontendCheckPassed = true; // å…è²»æª”æ¡ˆæŒ‰éˆ•å§‹çµ‚å•Ÿç”¨
      btn.title = userTier ? '' : 'é»æ“Šä¸‹è¼‰ï¼ˆéœ€è¦ç™»å…¥ï¼‰';
    } else {
      // ä»˜è²»æª”æ¡ˆï¼šéœ€è¦æª¢æŸ¥æœƒå“¡ç­‰ç´š
      if (requiresMembership) {
        if (!userTier) {
          frontendCheckPassed = false;
          btn.title = 'è«‹å…ˆç™»å…¥æœƒå“¡';
        } else {
          const tierNames = ['Free', 'Support', 'Creator\'s Choice', 'My Hero'];
          const requiredTierName = tierNames[requireTier] || 'Support';
          
          if (compareTiers(userTier, requiredTierName)) {
            frontendCheckPassed = true;
          } else {
            frontendCheckPassed = false;
            btn.title = `éœ€è¦ç­‰ç´šï¼š${requiredTierName}ï¼Œæ‚¨ç›®å‰ï¼š${userTier}`;
          }
        }
      } else {
        // å¦‚æœä¸è¦æ±‚æœƒå“¡ï¼Œä½†ä»éœ€è¦ç™»å…¥
        frontendCheckPassed = !!userTier;
        if (!userTier) {
          btn.title = 'è«‹å…ˆç™»å…¥æœƒå“¡';
        }
      }
    }

    // æ ¹æ“šå‰ç«¯æª¢æŸ¥çµæœè¨­å®šæŒ‰éˆ•ç‹€æ…‹
    if (frontendCheckPassed) {
      btn.disabled = false;
      btn.classList.add('can-download');
      btn.title = '';
    } else {
      btn.disabled = true;
      btn.classList.remove('can-download');
    }

    // é»æ“Šäº‹ä»¶ï¼šå…è²»æª”æ¡ˆç‰¹æ®Šè™•ç†ï¼Œä»˜è²»æª”æ¡ˆéœ€è¦æ¬Šé™æª¢æŸ¥
    btn.addEventListener('click', async () => {
      console.log('ğŸ–±ï¸ Download button clicked for tier:', requireTier);
      
      // å…è²»æª”æ¡ˆçš„ç‰¹æ®Šè™•ç†
      if (requireTier === 0) {
        if (!userTier) {
          // æœªç™»å…¥æ™‚é¡¯ç¤ºé€šçŸ¥
          console.log('âš ï¸ Showing login required notification');
          if (window.notify) {
            window.notify.warning('è«‹å…ˆç™»å…¥æœƒå“¡å¾Œå†ä¸‹è¼‰æª”æ¡ˆ', {
              title: 'éœ€è¦ç™»å…¥',
              duration: 4000
            });
          } else {
            alert('è«‹å…ˆç™»å…¥æœƒå“¡å¾Œå†ä¸‹è¼‰æª”æ¡ˆ');
          }
          return;
        }
        // å·²ç™»å…¥çš„å…è²»ç”¨æˆ¶ç›´æ¥ä¸‹è¼‰
        console.log('âœ… Free file, logged in user - direct download');
        window.open(downloadUrl, '_blank');
        return;
      }
      
      // ä»˜è²»æª”æ¡ˆçš„æ¬Šé™æª¢æŸ¥
      if (!frontendCheckPassed) return;
      
      console.log('ğŸ” Starting backend permission verification...');
      const finalCheck = await verifyDownloadPermission(downloadUrl);
      if (finalCheck.allowed) {
        window.open(downloadUrl, '_blank');
      } else {
        if (window.notify) {
          window.notify.error(finalCheck.message || 'ä¸‹è¼‰æ¬Šé™é©—è­‰å¤±æ•—', {
            title: 'ä¸‹è¼‰å¤±æ•—',
            duration: 5000
          });
        } else {
          alert(finalCheck.message || 'ä¸‹è¼‰æ¬Šé™é©—è­‰å¤±æ•—');
        }
      }
    });
  }

  // å»¶é²åŸ·è¡Œä»¥ç¢ºä¿ DOM æº–å‚™å¥½
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initDownloadBlock);
  } else {
    initDownloadBlock();
  }
</script>

<style>
.download-block-flex {
  border-radius: 12px;
  padding: 2rem 1.5rem;
  margin: 2rem 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.12);
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

/* å…è²»ç­‰ç´š - æ·±ç°è‰² */
.download-block-flex.tier-free {
  background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
  border: 1px solid #333;
}

/* Support ç­‰ç´š - è—è‰²æ¼¸è®Š */
.download-block-flex.tier-support {
  background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #1d4ed8 100%);
  border: 1px solid #2563eb;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
}

/* Creator's Choice ç­‰ç´š - ç´«è‰²æ¼¸è®Š */
.download-block-flex.tier-creators {
  background: linear-gradient(135deg, #581c87 0%, #8b5cf6 50%, #7c3aed 100%);
  border: 1px solid #8b5cf6;
  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.25);
}

/* My Hero ç­‰ç´š - é‡‘è‰²æ¼¸è®Š */
.download-block-flex.tier-hero {
  background: linear-gradient(135deg, #92400e 0%, #f59e0b 30%, #fbbf24 50%, #f59e0b 70%, #d97706 100%);
  border: 1px solid #f59e0b;
  box-shadow: 0 6px 16px rgba(245, 158, 11, 0.3);
}

/* ç‚ºæœ€é«˜ç­‰ç´šæ·»åŠ ç™¼å…‰æ•ˆæœ */
.download-block-flex.tier-hero::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
  animation: shimmer 3s ease-in-out infinite;
  pointer-events: none;
}

@keyframes shimmer {
  0%, 100% { transform: translateX(-100%); }
  50% { transform: translateX(100%); }
}

/* Hover æ•ˆæœ */
.download-block-flex.tier-support:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(59, 130, 246, 0.3);
}

.download-block-flex.tier-creators:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(139, 92, 246, 0.35);
}

.download-block-flex.tier-hero:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
}

.membership-label {
  color: #fff;
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 1.2rem;
  letter-spacing: 1px;
  text-shadow: 0 1px 2px rgba(0,0,0,0.8);
  position: relative;
}

/* å…è²»ç­‰ç´šæ¨™ç±¤ */
.tier-free .membership-label {
  color: #d1d5db;
  text-shadow: 0 1px 2px rgba(0,0,0,0.8);
}

/* Support ç­‰ç´šæ¨™ç±¤ */
.tier-support .membership-label {
  color: #dbeafe;
  text-shadow: 0 1px 2px rgba(0,0,0,0.8), 0 0 8px rgba(59, 130, 246, 0.3);
}

/* Creator's Choice ç­‰ç´šæ¨™ç±¤ */
.tier-creators .membership-label {
  color: #ede9fe;
  text-shadow: 0 1px 2px rgba(0,0,0,0.8), 0 0 8px rgba(139, 92, 246, 0.3);
}

/* My Hero ç­‰ç´šæ¨™ç±¤ - é‡‘è‰²æ•ˆæœä½†ä¿æŒå¯è®€æ€§ */
.tier-hero .membership-label {
  color: #fef3c7;
  text-shadow: 
    0 1px 2px rgba(0,0,0,0.8),
    0 0 10px rgba(245, 158, 11, 0.5),
    0 0 20px rgba(245, 158, 11, 0.3);
  font-weight: 700;
  animation: gold-glow 2s ease-in-out infinite alternate;
}

@keyframes gold-glow {
  0% { 
    text-shadow: 
      0 1px 2px rgba(0,0,0,0.8),
      0 0 10px rgba(245, 158, 11, 0.5),
      0 0 20px rgba(245, 158, 11, 0.3);
  }
  100% { 
    text-shadow: 
      0 1px 2px rgba(0,0,0,0.8),
      0 0 15px rgba(245, 158, 11, 0.8),
      0 0 30px rgba(245, 158, 11, 0.5);
  }
}
.download-flex-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 2rem;
}
.file-info-flex {
  flex: 1;
  min-width: 0;
}
.file-title {
  color: #fff;
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.7rem;
  word-break: break-all;
}
.file-description {
  color: #d1d5db;
  font-size: 0.95rem;
  font-weight: 400;
  margin-bottom: 0.8rem;
  line-height: 1.5;
  opacity: 0.9;
}

/* æ ¹æ“šä¸åŒç­‰ç´šèª¿æ•´æè¿°æ–‡å­—é¡è‰² */
.tier-support .file-description {
  color: #bfdbfe;
}
.tier-creators .file-description {
  color: #ddd6fe;
}
.tier-hero .file-description {
  color: #fef3c7;
  opacity: 0.95;
}
.file-badges {
  display: flex;
  gap: 0.7rem;
  flex-wrap: wrap;
}
.badge {
  display: inline-block;
  padding: 0.3rem 0.8rem;
  border-radius: 999px;
  font-size: 0.92rem;
  font-weight: 500;
  color: #fff;
  background: #444;
  letter-spacing: 0.5px;
}
.format-badge {
  text-transform: uppercase;
}
.size-badge {
  background: #666;
}
.name-badge {
  background: #333;
  color: #eee;
  max-width: 180px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.file-action-flex {
  display: flex;
  align-items: center;
  justify-content: flex-end;
}
.download-btn-flex {
  min-width: 120px;
  padding: 0.85rem 1.7rem;
  border-radius: 8px;
  font-size: 1.1rem;
  font-weight: 600;
  border: none;
  background: #555;
  color: #fff;
  cursor: not-allowed;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.download-btn-flex:disabled {
  opacity: 0.7;
}

/* å…è²»ç­‰ç´šæŒ‰éˆ• */
.tier-free .download-btn-flex.can-download {
  background: rgba(70 70 70 / 0.8);
  cursor: pointer;
}

.tier-free .download-btn-flex.can-download:hover {
  background: rgba(224 224 224 / 0.9);
}

/* Support ç­‰ç´šæŒ‰éˆ• */
.tier-support .download-btn-flex.can-download {
  background: linear-gradient(135deg, #1d4ed8 0%, #3b82f6 100%);
  border: 1px solid #2563eb;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
}

.tier-support .download-btn-flex.can-download:hover {
  background: linear-gradient(135deg, #2563eb 0%, #60a5fa 100%);
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(59, 130, 246, 0.3);
}

/* Creator's Choice ç­‰ç´šæŒ‰éˆ• */
.tier-creators .download-btn-flex.can-download {
  background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
  border: 1px solid #8b5cf6;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(139, 92, 246, 0.2);
}

.tier-creators .download-btn-flex.can-download:hover {
  background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(139, 92, 246, 0.3);
}

/* My Hero ç­‰ç´šæŒ‰éˆ• - è±ªè¯é‡‘è‰² */
.tier-hero .download-btn-flex.can-download {
  background: linear-gradient(135deg, #d97706 0%, #f59e0b 50%, #fbbf24 100%);
  border: 1px solid #f59e0b;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
  font-weight: 700;
}

.tier-hero .download-btn-flex.can-download:hover {
  background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 50%, #fcd34d 100%);
  transform: translateY(-3px);
  box-shadow: 0 8px 16px rgba(245, 158, 11, 0.4);
}

/* é‡‘è‰²æŒ‰éˆ•ç™¼å…‰æ•ˆæœ */
.tier-hero .download-btn-flex.can-download::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.2) 50%, transparent 70%);
  animation: button-shimmer 2s ease-in-out infinite;
  pointer-events: none;
}

@keyframes button-shimmer {
  0%, 100% { transform: translateX(-100%); }
  50% { transform: translateX(100%); }
}
@media (max-width: 700px) {
  .download-flex-row {
    flex-direction: column;
    align-items: stretch;
    gap: 1.2rem;
  }
  .file-action-flex {
    justify-content: stretch;
  }
}
</style>